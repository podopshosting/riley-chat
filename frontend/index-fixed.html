<!DOCTYPE html>
<html>
<head>
    <title>Riley Admin Dashboard</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f5f5f5; }
        .header { background: #0073aa; color: white; padding: 20px; }
        .nav-container { display: flex; min-height: calc(100vh - 80px); }
        .sidebar { width: 250px; background: white; padding: 20px; box-shadow: 2px 0 5px rgba(0,0,0,0.1); }
        .content { flex: 1; padding: 20px; }
        .nav-item { display: block; padding: 12px 15px; margin: 5px 0; text-decoration: none; color: #333; border-radius: 6px; cursor: pointer; }
        .nav-item:hover { background: #f0f0f0; }
        .nav-item.active { background: #0073aa; color: white; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .dashboard-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card-header { font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #0073aa; }
        .metric { display: flex; justify-content: space-between; margin: 10px 0; }
        .metric-value { font-weight: bold; color: #28a745; }
        .status-indicator { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; background: #28a745; }
        .btn { display: inline-block; padding: 10px 20px; margin: 5px; background: #0073aa; color: white; text-decoration: none; border-radius: 4px; cursor: pointer; border: none; }
        .page { display: none; }
        .page.active { display: block; }
        .kanban-board { display: flex; gap: 15px; }
        .conversation-card { cursor: pointer; transition: transform 0.2s; background: #f9f9f9; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 6px; }
        .conversation-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .card-actions { margin-top: 10px; }
        .card-actions button { padding: 5px 10px; margin-right: 5px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px; background: #0073aa; color: white; }
        .card-actions button:hover { background: #005a87; }
        .chat-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .chat-popup { background: white; width: 80%; max-width: 800px; height: 80%; border-radius: 8px; display: flex; flex-direction: column; }
        .chat-header { padding: 20px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; }
        .chat-input { padding: 20px; border-top: 1px solid #ddd; display: flex; gap: 10px; }
        .chat-input textarea { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .message { margin: 10px 0; padding: 10px; border-radius: 8px; }
        .message.user { background: #e3f2fd; }
        .message.bot { background: #f1f8e9; }
        .chat-messages { max-height: 500px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; margin: 10px 0; background: #f9f9f9; border-radius: 8px; }
        .message { margin: 10px 0; padding: 8px 12px; border-radius: 8px; max-width: 80%; }
        .message.user { background: #e3f2fd; margin-left: auto; text-align: right; }
        .message.bot { background: #f1f8e9; margin-right: auto; }
        .message-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin: 10px 0; }
        .send-btn { background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        .kanban-column { flex: 1; background: white; border-radius: 8px; padding: 15px; }
        .column-header { background: #f9f9f9; padding: 10px; margin: -15px -15px 15px -15px; font-weight: bold; }
        .conversation-card { background: #f9f9f9; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 6px; }
        .customer-name { font-weight: bold; color: #0073aa; margin-bottom: 5px; }
        .phone { color: #666; font-size: 14px; }
        .alert { padding: 10px; margin: 10px 0; border-radius: 4px; background: #d4edda; color: #155724; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Riley Admin Dashboard</h1>
        <p>SMS Bot Management System - Live AWS Data</p>
    </div>
    
    <div class="nav-container">
        <div class="sidebar">
            <h3>Navigation</h3>
            <div class="nav-item active" onclick="showPage('dashboard')">Dashboard</div>
            <div class="nav-item" onclick="showPage('kanban')">Kanban Board</div>
            <div class="nav-item" onclick="showPage('analytics')">Analytics</div>
            <div class="nav-item" onclick="showPage('status')">System Status</div>
            
            <h3 style="margin-top: 30px;">Quick Actions</h3>
            <div class="nav-item" onclick="testSMS()">Test SMS</div>
            <div class="nav-item" onclick="refreshData()">Refresh Data</div>
            
            <h3 style="margin-top: 30px;">System</h3>
            <div style="padding: 10px;">
                <p><span class="status-indicator"></span>SMS Bot: <span id="bot-status">Active</span></p>
                <p><span class="status-indicator"></span>Webhook: <span id="webhook-status">Connected</span></p>
                <p><span class="status-indicator"></span>Database: <span id="db-status">Online</span></p>
            </div>
        </div>
        
        <div class="content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <h2>Dashboard Overview</h2>
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <div class="card-header">SMS Activity</div>
                        <div class="metric">
                            <span>Total Conversations</span>
                            <span class="metric-value" id="total-conversations">Loading...</span>
                        </div>
                        <div class="metric">
                            <span>Active Conversations</span>
                            <span class="metric-value" id="active-conversations">Loading...</span>
                        </div>
                        <div class="metric">
                            <span>Completed Today</span>
                            <span class="metric-value" id="completed-conversations">Loading...</span>
                        </div>
                        <div class="metric">
                            <span>Total Messages</span>
                            <span class="metric-value" id="total-messages">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">Performance Metrics</div>
                        <div class="metric">
                            <span>Response Rate</span>
                            <span class="metric-value" id="response-rate">Loading...</span>
                        </div>
                        <div class="metric">
                            <span>Average Response Time</span>
                            <span class="metric-value">2.3 min</span>
                        </div>
                        <div class="metric">
                            <span>Lead Conversion</span>
                            <span class="metric-value" id="conversion-rate">Loading...</span>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-card" style="margin-top: 20px;">
                    <div class="card-header">Recent Activity</div>
                    <div id="recent-activity">Loading recent activity...</div>
                </div>
            </div>
            
            <!-- Kanban Page -->
            <div id="kanban" class="page">
                <h2>Kanban Board</h2>
                <p><strong>Live Data:</strong> <span id="kanban-status">Connected to DynamoDB</span></p>
                
                <div id="takeover-message" class="alert" style="display: none;"></div>
                
                <div style="display: flex; gap: 20px;">
                    <!-- Kanban Columns -->
                    <div style="flex: 1;">
                        <div class="kanban-board" style="display: flex; gap: 15px;">
                            <div class="kanban-column" style="flex: 1; background: white; border-radius: 8px; padding: 15px; min-height: 400px;" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-status="active">
                                <div class="column-header" style="background: #e3f2fd; padding: 10px; margin: -15px -15px 15px -15px; font-weight: bold;">
                                    Active (<span id="active-count">0</span>)
                                </div>
                                <div id="active-conversations-list">Loading...</div>
                            </div>
                            
                            <div class="kanban-column" style="flex: 1; background: white; border-radius: 8px; padding: 15px; min-height: 400px;" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-status="in_progress">
                                <div class="column-header" style="background: #fff3e0; padding: 10px; margin: -15px -15px 15px -15px; font-weight: bold;">
                                    In Progress (<span id="progress-count">0</span>)
                                </div>
                                <div id="progress-conversations-list">Loading...</div>
                            </div>
                            
                            <div class="kanban-column" style="flex: 1; background: white; border-radius: 8px; padding: 15px; min-height: 400px;" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-status="completed">
                                <div class="column-header" style="background: #e8f5e8; padding: 10px; margin: -15px -15px 15px -15px; font-weight: bold;">
                                    Completed (<span id="completed-count">0</span>)
                                </div>
                                <div id="completed-conversations-list">Loading...</div>
                            </div>
                            
                            <div class="kanban-column" style="flex: 1; background: white; border-radius: 8px; padding: 15px; min-height: 400px;" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" data-status="discarded">
                                <div class="column-header" style="background: #ffebee; padding: 10px; margin: -15px -15px 15px -15px; font-weight: bold;">
                                    Discarded (<span id="discarded-count">0</span>)
                                </div>
                                <div id="discarded-conversations-list">Loading...</div>
                            </div>
                        </div>
                    </div>
                    

                </div>
            </div>
            
            <!-- Analytics Page -->
            <div id="analytics" class="page">
                <h2>Analytics Dashboard</h2>
                
                <div style="background: white; padding: 15px; margin-bottom: 20px; border-radius: 8px;">
                    <label>Date Range:</label>
                    <input type="date" id="start-date" style="margin: 0 10px;">
                    <span>to</span>
                    <input type="date" id="end-date" style="margin: 0 10px;">
                    <button onclick="updateAnalytics()" class="btn">Update</button>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #0073aa; margin: 10px 0;" id="analytics-launches">0</div>
                        <div style="color: #666; font-size: 14px;">Total Launches</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #0073aa; margin: 10px 0;" id="analytics-replies">0</div>
                        <div style="color: #666; font-size: 14px;">Total Replies</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #0073aa; margin: 10px 0;" id="analytics-rate">0%</div>
                        <div style="color: #666; font-size: 14px;">Response Rate</div>
                    </div>
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 2.5em; font-weight: bold; color: #0073aa; margin: 10px 0;" id="analytics-progress">0</div>
                        <div style="color: #666; font-size: 14px;">In Progress</div>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
                    <h3>Campaign Performance</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f9f9f9;">
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Campaign</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Total</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Success Rate</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #ddd;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="campaign-table">
                            <tr><td colspan="4" style="padding: 12px;">Loading campaign data...</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h3>Recent Contacts History</h3>
                    <div id="contacts-history">Loading contact history...</div>
                </div>
            </div>
            
            <!-- Status Page -->
            <div id="status" class="page">
                <h2>System Status</h2>
                <p><strong>Last Updated:</strong> <span id="status-updated">Loading...</span></p>
                
                <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 8px;">
                    <h3>System Health</h3>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 4px;">
                        <span>SMS Bot Status</span>
                        <span style="color: #28a745; font-weight: bold;">Online</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 4px;">
                        <span>Webhook Connection</span>
                        <span style="color: #28a745; font-weight: bold;">Connected</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 4px;">
                        <span>Database Status</span>
                        <span style="color: #28a745; font-weight: bold;">Connected</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 4px;">
                        <span>Phone Number</span>
                        <span style="color: #28a745; font-weight: bold;">(301) 973-6753</span>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 8px;">
                    <h3>Test Instructions</h3>
                    <ol>
                        <li>Send "Hello Riley" to <strong>(301) 973-6753</strong></li>
                        <li>Riley asks: "What's your full name?"</li>
                        <li>Provide your name</li>
                        <li>Riley asks: "What is your full home address?"</li>
                        <li>Provide address</li>
                        <li>Riley asks: "What issues are you having?"</li>
                        <li>Describe issues</li>
                        <li>Riley confirms and completes conversation</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Inline JavaScript to avoid loading issues
        let conversationsData = [];
        let messagesData = [];
        
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
            
            if (pageId === 'dashboard') loadDashboardData();
            if (pageId === 'kanban') loadKanbanData();
        }
        
        async function loadConversationsData() {
            try {
                // Try to get live data from DynamoDB via Lambda
                const response = await fetch('https://sdgo4jrsic4o7xvkflkv5d6buy0mtfdh.lambda-url.us-east-1.on.aws/', {
                    method: 'POST',
                    body: JSON.stringify({ action: 'get_dashboard_data' })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        conversationsData = data.conversations || [];
                        messagesData = data.messages || [];
                        console.log('Loaded live data:', conversationsData.length, 'conversations');
                        return conversationsData;
                    }
                }
            } catch (error) {
                console.error('Failed to load live data:', error);
            }
            
            // Fallback to sample data
            conversationsData = [
                {
                    conversationId: '+19175698563',
                    customerName: 'Live Test User',
                    status: 'active',
                    lastMessage: 'Hello Riley - Live Test',
                    step: 'greeting'
                }
            ];
            messagesData = [];
            return conversationsData;
        }
        
        async function loadDashboardData() {
            await loadConversationsData();
            const totalEl = document.getElementById('total-conversations');
            const activeEl = document.getElementById('active-conversations');
            const completedEl = document.getElementById('completed-conversations');
            const messagesEl = document.getElementById('total-messages');
            const responseEl = document.getElementById('response-rate');
            const conversionEl = document.getElementById('conversion-rate');
            const updatedEl = document.getElementById('last-updated');
            
            const activeCount = conversationsData.filter(c => c.status === 'active').length;
            const completedCount = conversationsData.filter(c => c.status === 'completed').length;
            const responseRate = conversationsData.length > 0 ? Math.round((completedCount / conversationsData.length) * 100) : 0;
            
            if (totalEl) totalEl.textContent = conversationsData.length;
            if (activeEl) activeEl.textContent = activeCount;
            if (completedEl) completedEl.textContent = completedCount;
            if (messagesEl) messagesEl.textContent = messagesData.length;
            if (responseEl) responseEl.textContent = responseRate + '%';
            if (conversionEl) conversionEl.textContent = responseRate + '%';
            if (updatedEl) updatedEl.textContent = new Date().toLocaleTimeString();
            
            // Load recent activity
            const activityEl = document.getElementById('recent-activity');
            if (activityEl) {
                let activityHtml = messagesData.length > 0 ? '' : '<p>No recent activity. Send SMS to (301) 973-6753 to test.</p>';
                messagesData.slice(-5).forEach(msg => {
                    const conv = conversationsData.find(c => c.conversationId === msg.conversationId);
                    const name = conv ? conv.customerName : 'Unknown';
                    activityHtml += `<div style="padding: 10px; border-bottom: 1px solid #eee;"><strong>${new Date(msg.timestamp).toLocaleTimeString()}</strong> - ${msg.sender === 'user' ? name : 'Riley'}: "${msg.content.substring(0, 50)}..."</div>`;
                });
                activityEl.innerHTML = activityHtml;
            }
        }
        
        async function loadKanbanData() {
            await loadConversationsData();
            const activeConvs = conversationsData.filter(c => c.status === 'active');
            const progressConvs = conversationsData.filter(c => c.status === 'in_progress');
            const completedConvs = conversationsData.filter(c => c.status === 'completed');
            const discardedConvs = conversationsData.filter(c => c.status === 'discarded');
            
            const activeCountEl = document.getElementById('active-count');
            const progressCountEl = document.getElementById('progress-count');
            const completedCountEl = document.getElementById('completed-count');
            const discardedCountEl = document.getElementById('discarded-count');
            
            if (activeCountEl) activeCountEl.textContent = activeConvs.length;
            if (progressCountEl) progressCountEl.textContent = progressConvs.length;
            if (completedCountEl) completedCountEl.textContent = completedConvs.length;
            if (discardedCountEl) discardedCountEl.textContent = discardedConvs.length;
            
            populateColumn('active-conversations-list', activeConvs, 'active');
            populateColumn('progress-conversations-list', progressConvs, 'in_progress');
            populateColumn('completed-conversations-list', completedConvs, 'completed');
            populateColumn('discarded-conversations-list', discardedConvs, 'discarded');
        }
        
        function populateColumn(elementId, conversations, type) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            let html = conversations.length === 0 ? '<p>No conversations.</p>' : '';
            conversations.forEach(conv => {
                const displayName = conv.customerName && conv.customerName !== 'SMS User' ? conv.customerName : 'New User';
                html += `
                    <div class="conversation-card" draggable="true" ondragstart="drag(event)" data-conversation-id="${conv.conversationId}" onclick="openChat('${conv.conversationId}', '${type}')">
                        <div class="customer-name">${displayName}</div>
                        <div class="phone">${conv.conversationId}</div>
                        <p>"${(conv.lastMessage || '').substring(0, 40)}..."</p>
                        <div class="card-actions">
                            ${type === 'active' ? `<button onclick="event.stopPropagation(); takeOverConversation('${conv.conversationId}')">Take Over</button>` : ''}
                            ${type === 'progress' ? `<button onclick="event.stopPropagation(); moveConversation('${conv.conversationId}', 'completed')">Complete</button>` : ''}
                            ${type !== 'discarded' ? `<button onclick="event.stopPropagation(); moveConversation('${conv.conversationId}', 'discarded')">Discard</button>` : ''}
                        </div>
                    </div>
                `;
            });
            element.innerHTML = html;
        }
        
        function moveConversation(conversationId, newStatus) {
            const conv = conversationsData.find(c => c.conversationId === conversationId);
            if (conv) {
                conv.status = newStatus;
                console.log(`Moving ${conversationId} to ${newStatus}`);
                loadKanbanData();
            }
        }
        
        function takeOverConversation(conversationId) {
            const conv = conversationsData.find(c => c.conversationId === conversationId);
            if (conv) {
                conv.status = 'in_progress';
                loadKanbanData();
                openChat(conversationId, 'progress');
            }
        }
        
        function discardConversation(conversationId) {
            console.log(`Discarding ${conversationId}`);
            moveConversation(conversationId, 'discarded');
        }
        
        // Drag and drop functionality
        function allowDrop(ev) {
            ev.preventDefault();
            ev.currentTarget.style.backgroundColor = '#f0f0f0';
        }
        
        function drag(ev) {
            const conversationId = ev.currentTarget.dataset.conversationId;
            ev.dataTransfer.setData('text', conversationId);
            console.log('Dragging:', conversationId);
        }
        
        function drop(ev) {
            ev.preventDefault();
            ev.currentTarget.style.backgroundColor = '';
            const conversationId = ev.dataTransfer.getData('text');
            const newStatus = ev.currentTarget.dataset.status;
            console.log('Dropping:', conversationId, 'to', newStatus);
            moveConversation(conversationId, newStatus);
        }
        
        function dragLeave(ev) {
            ev.currentTarget.style.backgroundColor = '';
        }
        
        function openChat(conversationId, type) {
            const conv = conversationsData.find(c => c.conversationId === conversationId);
            const messages = messagesData.filter(m => m.conversationId === conversationId);
            
            let chatHtml = `
                <div class="chat-overlay" onclick="closeChat()">
                    <div class="chat-popup" onclick="event.stopPropagation()">
                        <div class="chat-header">
                            <h3>${conv.customerName || 'New User'} - ${conversationId}</h3>
                            <button onclick="closeChat()">×</button>
                        </div>
                        <div class="chat-messages">
            `;
            
            messages.forEach(msg => {
                chatHtml += `<div class="message ${msg.sender}"><strong>${msg.sender === 'user' ? conv.customerName : 'Riley'}:</strong> ${msg.content}</div>`;
            });
            
            if (type === 'progress') {
                chatHtml += `
                        </div>
                        <div class="chat-input">
                            <textarea id="reply-text" placeholder="Type reply..."></textarea>
                            <button onclick="sendReply('${conversationId}')">Send</button>
                        </div>
                `;
            } else {
                chatHtml += '</div>';
            }
            
            chatHtml += '</div></div>';
            document.body.insertAdjacentHTML('beforeend', chatHtml);
        }
        
        function closeChat() {
            document.querySelector('.chat-overlay')?.remove();
        }
        
        function sendReply(conversationId) {
            const text = document.getElementById('reply-text').value;
            if (text.trim()) {
                // Add message to chat immediately
                const chatMessages = document.querySelector('.chat-messages');
                chatMessages.innerHTML += `<div class="message bot"><strong>Agent:</strong> ${text}</div>`;
                
                // Add to messages data
                messagesData.push({
                    conversationId: conversationId,
                    sender: 'agent',
                    content: text,
                    timestamp: new Date().toISOString()
                });
                
                // Clear input
                document.getElementById('reply-text').value = '';
                
                // Send SMS via webhook
                fetch('https://sdgo4jrsic4o7xvkflkv5d6buy0mtfdh.lambda-url.us-east-1.on.aws/', {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'send_sms',
                        to: conversationId,
                        message: text
                    })
                }).catch(error => console.error('SMS send failed:', error));
                
                console.log(`SMS sent to ${conversationId}: ${text}`);
            }
        }
        
        function testSMS() {
            alert('Send "Hello Riley" to (301) 973-6753 to test');
        }
        
        function refreshData() {
            const activePage = document.querySelector('.page.active').id;
            if (activePage === 'dashboard') loadDashboardData();
            if (activePage === 'kanban') loadKanbanData();
            if (activePage === 'analytics') loadAnalyticsData();
        }
        
        function updateAnalytics() {
            loadAnalyticsData();
        }
        
        async function loadAnalyticsData() {
            await loadConversationsData();
            
            const totalLaunches = conversationsData.length;
            const totalReplies = conversationsData.filter(c => c.status === 'completed').length;
            const inProgress = conversationsData.filter(c => c.status === 'in_progress').length;
            const responseRate = totalLaunches > 0 ? Math.round((totalReplies / totalLaunches) * 100) : 0;
            
            const launchesEl = document.getElementById('analytics-launches');
            const repliesEl = document.getElementById('analytics-replies');
            const rateEl = document.getElementById('analytics-rate');
            const progressEl = document.getElementById('analytics-progress');
            
            if (launchesEl) launchesEl.textContent = totalLaunches;
            if (repliesEl) repliesEl.textContent = totalReplies;
            if (rateEl) rateEl.textContent = responseRate + '%';
            if (progressEl) progressEl.textContent = inProgress;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            // Auto-refresh every 5 seconds for real-time updates
            setInterval(() => {
                const activePage = document.querySelector('.page.active').id;
                if (activePage === 'kanban') {
                    loadKanbanData();
                }
            }, 5000);
        });
    </script>
</body>
</html>